<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Andrew Ijano" href="https://example.com/rss.xml"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.css"><meta name="generator" content="Astro v5.4.1"><!-- Canonical URL --><link rel="canonical" href="https://example.com/mac5856/06-writing-patch/"><!-- Primary Meta Tags --><title>[Linux] Making a first patch</title><meta name="title" content="[Linux] Making a first patch"><meta name="description" content="This report shows how we made a first patch to the Linux kernel"><style>:root{--accent: #ccc;--accent-lighter: white;--background: #030303;--background-code: #24292e;--black: 15, 18, 25;--gray: 96, 115, 159;--gray-light: 229, 233, 240;--gray-dark: 34, 41, 57;--gray-gradient: rgba(var(--gray-light), 50%), #fff;--box-shadow: 0 2px 6px rgba(var(--gray), 25%), 0 8px 24px rgba(var(--gray), 33%), 0 16px 32px rgba(var(--gray), 33%)}*{font-family:Hack,monospace;margin:0;padding:0}body{padding:1em 2em;text-align:left;word-wrap:break-word;overflow-wrap:break-word;color:var(--accent);background-color:var(--background);font-size:.93em;letter-spacing:-.02em;line-height:1.5;font-weight:400;text-rendering:"optimizeLegibility"}main{max-width:calc(100% - 2em);padding:2em 0}h1,h2,h3,h4,h5,h6{margin-top:2.5em;line-height:1.2;color:var(--accent-lighter);font-weight:bolder}.prose h1,h2,h3,h4,h5,h6{margin-bottom:-.6em}h1{font-size:1.2em}h2,h3,h4,h5,h6{font-size:1.1em}strong,b{font-weight:700}a{color:var(--accent);text-decoration:"underline"}a:hover{color:var(--accent-lighter)}.prose p{margin-top:1.6em;color:(--accent)}textarea{width:100%;font-size:16px}input{font-size:1em}table{width:100%}img{max-width:100%;height:auto;border-radius:8px}code{padding:2px 5px;border-radius:2px;font-size:.9em;background-color:var(--background-code);color:var(--accent-lighter)}pre{padding:1.5em;border-radius:8px;margin-top:.5em;margin-bottom:2em}pre>code{all:unset;font-size:.8em}blockquote{border-left:2px solid var(--accent);padding:0 0 0 20px;margin:2em 0}hr{border:none}ul{margin-top:.5em;margin-left:1em}ol{margin-top:.5em;margin-left:2em}li{margin:.5em 0}@media (min-width: 720px){body{font-size:1em;padding:1em 5em}main{padding:1em;width:720px}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}a[data-astro-cid-eimmu3lg]{display:inline-block;color:var(--accent)}a[data-astro-cid-eimmu3lg]:hover{color:var(--accent-lighter)}.active[data-astro-cid-eimmu3lg]{font-weight:bolder;color:var(--accent-lighter)}header[data-astro-cid-3ef6ksr2]{margin:0;width:100%}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] div[data-astro-cid-3ef6ksr2]{display:flex;gap:1em}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{border-bottom:2px solid transparent;text-decoration:none}.active[data-astro-cid-3ef6ksr2]{border-bottom:2px solid transparent;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}.site-title[data-astro-cid-3ef6ksr2]{color:#fff}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}
footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;color:var(--accent);font-size:.8em;text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}body{display:flex;flex-direction:column;align-items:center}main[data-astro-cid-bvzihdzo]{max-width:100%;margin:0}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{margin:auto;color:var(--accent)}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em;color:var(--accent-lighter)}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:rgb(var(--accent))}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}@media (min-width: 680px){.prose[data-astro-cid-bvzihdzo]{width:680px;max-width:calc(100% - 2em)}}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <a class="site-title" href="/" data-astro-cid-3ef6ksr2>Andrew Ijano</a> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> /home </a>  <a href="/mac5856" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> /mac5856 </a>  </div> </nav> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2025-04-20T03:00:00.000Z"> 2025-04-20 </time> </div> <h1 data-astro-cid-bvzihdzo>[Linux] Making a first patch</h1> <hr data-astro-cid-bvzihdzo> </div>  <p>In this report, we show how we made our first patch for the Linux kernel in the IIO subsystem.</p>
<h2 id="1-setting-up-the-branch">1. Setting up the branch</h2>
<p>First we ensured that our <code>testing</code> branch was updated and we created a new branch for it.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> pull</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> reset</span><span style="color:#79B8FF"> --hard</span><span style="color:#9ECBFF"> origin/testing</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> checkout</span><span style="color:#79B8FF"> -b</span><span style="color:#9ECBFF"> accel-sca3000-remove-read-data-short</span></span></code></pre>
<h2 id="2-developing-the-patch">2. Developing the patch</h2>
<p>After that, we removed the duplicated code, centralized all the shared behavior in one <code>sca3000_read_data</code> function.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#F97583">static</span><span style="color:#F97583"> int</span><span style="color:#B392F0"> sca3000_read_data</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">struct</span><span style="color:#E1E4E8"> sca3000_state </span><span style="color:#F97583">*</span><span style="color:#FFAB70">st</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                 u8 </span><span style="color:#FFAB70">reg_address_high</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#F97583">                 int</span><span style="color:#FFAB70"> len</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    int</span><span style="color:#E1E4E8"> ret;</span></span>
<span class="line"><span style="color:#F97583">    struct</span><span style="color:#E1E4E8"> spi_transfer </span><span style="color:#FFAB70">xfer</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#E1E4E8">            .len </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            .tx_buf </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> st->tx,</span></span>
<span class="line"><span style="color:#E1E4E8">        }, {</span></span>
<span class="line"><span style="color:#E1E4E8">            .len </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> len,</span></span>
<span class="line"><span style="color:#E1E4E8">            .rx_buf </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> st->rx,</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    st->tx[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> SCA3000_READ_REG</span><span style="color:#E1E4E8">(reg_address_high);</span></span>
<span class="line"><span style="color:#E1E4E8">    ret </span><span style="color:#F97583">=</span><span style="color:#B392F0"> spi_sync_transfer</span><span style="color:#E1E4E8">(st->us, xfer, </span><span style="color:#B392F0">ARRAY_SIZE</span><span style="color:#E1E4E8">(xfer));</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (ret) {</span></span>
<span class="line"><span style="color:#B392F0">        dev_err</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">st->us->dev, </span><span style="color:#9ECBFF">"problem reading register</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> ret;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<blockquote>
<p>Even though we noticed many possible points to improve the code quality of this file, we tried to minimize changes in this patch, since we didn’t know the code standards in the project.</p>
</blockquote>
<p>After making the changes, we enabled this module and compiled the kernel.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">make</span><span style="color:#9ECBFF"> ./activate</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">cd</span><span style="color:#9ECBFF"> iio</span></span>
<span class="line"><span style="color:#B392F0">make</span><span style="color:#9ECBFF"> menuconfig</span><span style="color:#6A737D"> # and enable the module</span></span>
<span class="line"><span style="color:#B392F0">make</span><span style="color:#79B8FF"> -j$(</span><span style="color:#B392F0">nproc</span><span style="color:#79B8FF">)</span><span style="color:#9ECBFF"> clean</span></span>
<span class="line"><span style="color:#B392F0">make</span><span style="color:#79B8FF"> -j$(</span><span style="color:#B392F0">nproc</span><span style="color:#79B8FF">)</span><span style="color:#9ECBFF"> Image.gz</span><span style="color:#9ECBFF"> modules</span></span></code></pre>
<h2 id="3-commiting-the-changes">3. Commiting the changes</h2>
<p>Then we could finally commit our changes. I ensured I had the correct name and email configuration, and added information about my partner that co-developed the patch.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> config</span><span style="color:#79B8FF"> --global</span><span style="color:#9ECBFF"> user.name</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">My</span><span style="color:#9ECBFF"> Nam</span><span style="color:#E1E4E8">e</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> config</span><span style="color:#79B8FF"> --global</span><span style="color:#9ECBFF"> user.email</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">my@email.co</span><span style="color:#E1E4E8">m</span><span style="color:#F97583">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> commit</span><span style="color:#79B8FF"> --signoff</span><span style="color:#79B8FF"> --trailer=</span><span style="color:#9ECBFF">'Co-developed-by: My Partner Name &#x3C;mypartner@email.com>'</span><span style="color:#79B8FF"> --trailer=</span><span style="color:#9ECBFF">'Signed-off-by: My Partner Name &#x3C;mypartner@email.com>'</span></span></code></pre>
<p>We wrote the following commit message.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>iio: accel: sca3000: remove duplicated code in sca3000_read_data</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Remove duplicated code between sca3000_read_data and</span></span>
<span class="line"><span>sca3000_read_data_short functions.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>The common behavior is centralized in just one</span></span>
<span class="line"><span>sca3000_read_data function and used for every</span></span>
<span class="line"><span>case.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Signed-off-by: My Name &#x3C;my@email.com></span></span>
<span class="line"><span>Co-developed-by: My Partner Name &#x3C;mypartner@email.com></span></span>
<span class="line"><span>Signed-off-by: My Partner Name &#x3C;mypartner@email.com></span></span></code></pre>
<h2 id="4-checking-for-code-style-problems">4. Checking for code style problems</h2>
<p>To ensure this commit didn’t introduce any code style problems to the project, we ran the following command.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> format-patch</span><span style="color:#79B8FF"> -1</span><span style="color:#79B8FF"> --stdout</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> ./scripts/checkpatch.pl</span><span style="color:#79B8FF"> --</span></span></code></pre>
<p>And this was the result.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>total: 0 errors, 0 warnings, 238 lines checked</span></span>
<span class="line"><span></span></span>
<span class="line"><span>"[PATCH] iio: accel: sca3000: remove duplicated code in" has no obvious style problems and is ready for submission.</span></span></code></pre>
<h2 id="5-configuring-git-for-sending-patches">5. Configuring git for sending patches</h2>
<p>Patches for the Linux kernel are sent through email. So, we need to configure our git to send them. Since I used a Gmail email provider, the following configurations are based on that.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> config</span><span style="color:#79B8FF"> --global</span><span style="color:#9ECBFF"> sendemail.smtpuser</span><span style="color:#F97583"> &#x3C;</span><span style="color:#9ECBFF">my@email.co</span><span style="color:#E1E4E8">m</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> config</span><span style="color:#79B8FF"> --global</span><span style="color:#9ECBFF"> sendemail.smtpencryption</span><span style="color:#9ECBFF"> tls</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> config</span><span style="color:#79B8FF"> --global</span><span style="color:#9ECBFF"> sendemail.smtpserver</span><span style="color:#9ECBFF"> smtp.gmail.com</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> config</span><span style="color:#79B8FF"> --global</span><span style="color:#9ECBFF"> sendemail.smtpserverport</span><span style="color:#79B8FF"> 587</span></span></code></pre>
<p>I also had to create an app password in <a href="https://myaccount.google.com/security">https://myaccount.google.com/security</a>.</p>
<blockquote>
<p>Although the tutorial suggests the use of a <code>@usp.br</code> email (the email of my university), it seems the use of app passwords are disabled. So, I used my personal Gmail for that.</p>
</blockquote>
<h2 id="6-sending-contributions-for-internal-review">6. Sending contributions for internal review</h2>
<p>Before sending the contribution for the real mailing lists and maintainers, we sent our contribution the a temporary email of this course for internal review.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> send-email</span><span style="color:#79B8FF"> -1</span><span style="color:#79B8FF"> --suppress-cc=all</span><span style="color:#79B8FF"> --cc=</span><span style="color:#9ECBFF">"my@email.com"</span><span style="color:#79B8FF"> --cc=</span><span style="color:#9ECBFF">"mypartner@email.com"</span><span style="color:#79B8FF"> --to=</span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF">freesoftwarecourse@email.com</span><span style="color:#F97583">></span></span></code></pre>  </div> </article> </main> <footer data-astro-cid-sz7xmlte> <a href="https://andrewijano.github.io" data-astro-cid-sz7xmlte>andrewijano.github.io</a> &copy; 2025 by Andrew Ijano is licensed under <a href="https://creativecommons.org/licenses/by/4.0/" data-astro-cid-sz7xmlte>CC BY 4.0</a>.
</footer>  </body></html>